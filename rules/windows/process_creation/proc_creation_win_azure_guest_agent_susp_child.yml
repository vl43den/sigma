title: Suspicious Child Process Of Windows Azure Guest Agent
id: bb71bcd1-7f61-45cd-9403-25f963a6128c
related:
    - id: 5a2e6f43-85f2-4e6a-8d3b-9c2e1f4a5b6c
      type: similar
status: experimental
description: |
    Detects suspicious processes spawned under the WindowsAzureGuestAgent.exe process tree.
    Azure Run Command creates a distinct process tree under this agent. When combined with
    credential harvesting tools like ntdsutil or procdump, this indicates potential abuse
    of Azure management features for lateral movement or credential theft.
author: Vladan Sekulic
date: 2025-12-17
references:
    - https://cloud.google.com/blog/topics/threat-intelligence/azure-run-command-dummies
    - https://cloud.google.com/blog/topics/threat-intelligence/russian-targeting-gov-business
logsource:
    product: windows
    category: process_creation
detection:
    selection_parent:
        ParentImage|endswith: '\WindowsAzureGuestAgent.exe'
    selection_critical:
        - Image|endswith:
              - '\ntdsutil.exe'
              - '\procdump.exe'
              - '\procdump64.exe'
              - '\sekurlsa.exe'
              - '\mimikatz.exe'
              - '\rubeus.exe'
              - '\sharphound.exe'
        - CommandLine|contains:
              - 'ntds'
              - 'lsass'
              - 'sekurlsa'
              - 'kerberos::list'
              - 'privilege::debug'
    condition: selection_parent and selection_critical
falsepositives:
    - Unknown
level: critical
tags:
    - attack.credential-access
    - attack.t1003.001
    - attack.t1003.003
    - attack.execution
    - attack.t1059.001
